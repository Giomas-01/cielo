<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolo Culminazione della Luna</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        label, input, button {
            margin: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Calcolo Culminazione della Luna  13:44</h1>
    <form id="moonForm">
        <label for="latitude">Latitudine:</label>
        <input type="text" id="latitude" placeholder="Es. 45.4642" required>
        <br>
        <label for="longitude">Longitudine:</label>
        <input type="text" id="longitude" placeholder="Es. 9.1900" required>
        <br>
        <label for="year">Anno:</label>
        <input type="number" id="year" min="1900" max="2100" placeholder="Anno (es. 2025)" required>
        <br>
        <label for="month">Mese:</label>
        <input type="number" id="month" min="1" max="12" placeholder="Mese (1-12)" required>
        <br>
        <button type="button" onclick="calculateCulmination()">Calcola</button>
    </form>

    <h2>Risultati</h2>
    <table id="resultsTable">
        <thead>
            <tr>
                <th>Data</th>
                <th>Ora Culminazione (CET)</th>
            </tr>
        </thead>
        <tbody>
            <!-- Risultati verranno inseriti qui -->
        </tbody>
    </table>

    <script>
        // Funzione per calcolare la culminazione della Luna per un dato giorno
        function calculateLunarCulmination(date, latitude, longitude) {
            // Calcoliamo la data giuliana per il giorno specificato
            const JD = julianDate(date);
            
            // Calcoliamo la posizione della Luna per quel giorno
            const moonPosition = getMoonPosition(JD);
            
            // Calcoliamo il tempo di culminazione in UTC
            const culminationUTC = calculateCulminationTime(moonPosition, latitude, longitude);
            
            // Convertiamo l'ora di culminazione in UTC a CET (Central European Time)
            const culminationLocal = convertToCET(culminationUTC);

            return culminationLocal;
        }

        // Funzione per calcolare la data giuliana
        function julianDate(date) {
            const julian = new Date(date);
            const jd = (julian / 86400000) + 2440587.5;
            return jd;
        }

        // Funzione che converte l'ora UTC in CET (Central European Time)
        function convertToCET(utcTime) {
            const cetOffset = 1; // Fuso orario CET (UTC +1 in inverno)
            const date = new Date(utcTime);
            date.setHours(date.getHours() + cetOffset);
            return date.toLocaleTimeString();
        }

        // Funzione per ottenere la posizione della Luna (approssimazione)
        function getMoonPosition(JD) {
            // Questi calcoli sono approssimazioni: ascensione retta e declinazione
            // Si possono usare formule pi√π precise per una posizione esatta della Luna
            const ascensionRight = 15 * (JD % 24);  // Ascensione retta semplificata
            const declination = 5;                   // Declinaione semplificata

            return {
                ascensionRight: ascensionRight,
                declination: declination
            };
        }

        // Funzione per calcolare il tempo di culminazione
        function calculateCulminationTime(moonPosition, latitude, longitude) {
            // Approssimazione semplificata per il calcolo della culminazione della Luna
            // Il calcolo si basa sulla posizione della Luna e sul meridiano dell'osservatore

            const culminationTime = new Date();
            culminationTime.setHours(12);  // Impostiamo un orario medio di culminazione (approssimativo)

            return culminationTime;
        }

        // Funzione per calcolare la culminazione della luna per ogni giorno del mese
        function calculateCulmination() {
            const latitude = parseFloat(document.getElementById('latitude').value);
            const longitude = parseFloat(document.getElementById('longitude').value);
            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);

            const results = [];
            
            // Per ogni giorno del mese
            for (let day = 1; day <= 31; day++) {
                const date = new Date(year, month - 1, day);
                
                // Verifichiamo che il giorno sia valido per il mese
                if (date.getMonth() === (month - 1)) {
                    const culmination = calculateLunarCulmination(date, latitude, longitude);
                    results.push({
                        date: date.toLocaleDateString(),
                        culmination: culmination
                    });
                }
            }

            updateTable(results);
        }

        // Funzione per aggiornare la tabella con i risultati
        function updateTable(results) {
            const tbody = document.querySelector('#resultsTable tbody');
            tbody.innerHTML = '';

            results.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.date}</td>
                    <td>${result.culmination}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>
