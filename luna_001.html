<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolo Culminazione della Luna</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        label, input, button {
            margin: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Calcolo Culminazione della Luna</h1>
    <form id="moonForm">
        <label for="latitude">Latitudine:</label>
        <input type="text" id="latitude" placeholder="Es. 45.4642" required>
        <br>
        <label for="longitude">Longitudine:</label>
        <input type="text" id="longitude" placeholder="Es. 9.1900" required>
        <br>
        <label for="month">Mese:</label>
        <input type="number" id="month" min="1" max="12" placeholder="Mese (1-12)" required>
        <br>
        <button type="button" onclick="calculateCulmination()">Calcola</button>
    </form>

    <h2>Risultati</h2>
    <table id="resultsTable">
        <thead>
            <tr>
                <th>Data</th>
                <th>Ora Culminazione (CET) 13:40</th>
            </tr>
        </thead>
        <tbody>
            <!-- Risultati verranno inseriti qui -->
        </tbody>
    </table>

    <script>
        // Funzione per calcolare la culminazione della Luna per un dato giorno
        function calculateLunarCulmination(date, latitude, longitude) {
            // Valori approssimativi per la posizione della Luna per il calcolo
            // Questi devono essere sostituiti con i calcoli astronomici precisi
            const JD = julianDate(date); // Calcola la data giuliana
            const moonPosition = getMoonPosition(JD); // Calcola la posizione della Luna
            
            // Calcoliamo l'ora di culminazione in UTC
            const culminationUTC = calculateCulminationTime(moonPosition, latitude, longitude);
            
            // Convertiamo l'ora in UTC nel fuso orario locale (CET per l'Italia)
            const culminationLocal = convertToCET(culminationUTC);

            return culminationLocal;
        }

        // Funzione che converte l'ora UTC in CET (Central European Time)
        function convertToCET(utcTime) {
            const cetOffset = 1; // Fuso orario CET (UTC +1 in inverno)
            const date = new Date(utcTime);
            date.setHours(date.getHours() + cetOffset);
            return date.toLocaleTimeString();
        }

        // Funzione per ottenere la posizione della Luna (approssimazione)
        function getMoonPosition(JD) {
            // Funzioni di calcolo astrononomico per determinare posizione della luna (ascensione retta, declinazione)
            // Eseguiamo i calcoli per ottenere la posizione della luna per quel giorno (approssimativa)
            return {
                ascensionRight: 15 * (JD % 24),  // Esempio di calcolo semplificato dell'ascensione retta
                declination: 5,                   // Esempio di calcolo semplificato della declinazione
            };
        }

        // Funzione per calcolare il tempo di culminazione (approssimazione)
        function calculateCulminationTime(moonPosition, latitude, longitude) {
            // Algoritmo semplificato per calcolare la culminazione (approssimato)
            // basato sulla posizione della luna (ascensione retta e declinazione)
            // e la latitudine e longitudine dell'osservatore
            const culminationTime = new Date();
            culminationTime.setHours(12); // Approccio semplificato, possiamo regolare
            return culminationTime;
        }

        // Funzione per calcolare la data giuliana
        function julianDate(date) {
            const julian = new Date(date);
            const jd = (julian / 86400000) + 2440587.5;
            return jd;
        }

        // Funzione per calcolare la culminazione della luna per ogni giorno del mese
        function calculateCulmination() {
            const latitude = parseFloat(document.getElementById('latitude').value);
            const longitude = parseFloat(document.getElementById('longitude').value);
            const month = parseInt(document.getElementById('month').value);

            const results = [];
            const currentYear = new Date().getFullYear();

            for (let day = 1; day <= 31; day++) {
                const date = new Date(currentYear, month - 1, day);
                if (date.getMonth() === (month - 1)) {
                    const culmination = calculateLunarCulmination(date, latitude, longitude);
                    results.push({
                        date: date.toLocaleDateString(),
                        culmination: culmination
                    });
                }
            }

            updateTable(results);
        }

        // Funzione per aggiornare la tabella con i risultati
        function updateTable(results) {
            const tbody = document.querySelector('#resultsTable tbody');
            tbody.innerHTML = '';

            results.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.date}</td>
                    <td>${result.culmination}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>
