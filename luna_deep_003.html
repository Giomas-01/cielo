<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Orari Lunari Dinamici</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .moon-info { background: #f8f9fa; padding: 20px; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="moon-info" id="moonData"></div>
    </div>

<script>
// Funzione principale aggiornata
function updateMoonData() {
    const now = new Date();
    const moonAge = calculateMoonAge(now);
    const phase = getMoonPhase(moonAge);
    
    // CALCOLO ORA DINAMICO (corretto)
    const moonTimes = calculateMoonTimes(now, moonAge);
    
    document.getElementById('moonData').innerHTML = `
        <h2>Fase Lunare - ${now.toLocaleDateString('it-IT')}</h2>
        <p>‚è≥ Et√†: ${moonAge} giorni</p>
        <p>üåë Fase: ${phase}</p>
        <p>üåñ Alba lunare: ${moonTimes.rise}</p>
        <p>üåò Tramonto lunare: ${moonTimes.set}</p>
    `;
}

// Calcolo preciso et√† lunare (corretto)
function calculateMoonAge(date) {
    const referenceNewMoon = new Date(2024, 0, 11, 11, 57); // Data corretta (11 gennaio 2024 11:57 UTC)
    const diff = date - referenceNewMoon;
    const lunarCycle = 29.53058867 * 86400000; // Ciclo in millisecondi
    return ((diff % lunarCycle) / 86400000).toFixed(1);
}

// Nuovo sistema di calcolo orari (simulazione realistica)
function calculateMoonTimes(date, moonAge) {
    const baseHour = date.getHours();
    const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);

    // Simula la variazione giornaliera (la Luna sorge ~50 minuti dopo ogni giorno)
    const dailyOffset = dayOfYear * 50; // 50 minuti di ritardo progressivo
    const riseHour = ((baseHour * 60 + dailyOffset) % 1440) / 60;
    const setHour = ((riseHour + 8.5) % 24);

    return {
        rise: formatTime(riseHour),
        set: formatTime(setHour)
    };
}

function formatTime(hours) {
    const h = Math.floor(hours);
    const m = Math.round((hours % 1) * 60);
    return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
}

// Aggiornamento automatico
window.onload = () => {
    updateMoonData();
    setInterval(updateMoonData, 3600000); // Aggiorna ogni ora
};
</script>
</body>
</html>
