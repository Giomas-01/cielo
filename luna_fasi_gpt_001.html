<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Fasi della Luna</title>
    <script type="text/javascript" src="lib/astrojs.js"></script>
</head>
<body>
    <h1>Fasi della Luna</h1>
    <form id="lunarForm">
        <label for="year">Anno:</label>
        <input type="number" id="year" min="1900" max="2100" required>
        
        <label for="utcOffset">UTC Offset:</label>
        <select id="utcOffset">
            <script>
                for (let i = -12; i <= 14; i++) {
                    document.write(`<option value="${i}">${i}</option>`);
                }
            </script>
        </select>
        
        <button type="button" onclick="calculatePhases()">Calcola</button>
    </form>
    
    <table border="1" id="resultTable">
        <thead>
            <tr>
                <th>Data</th>
                <th>Ora (UTC Offset)</th>
                <th>Fase</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    
    <script>
        function calculatePhases() {
            let year = parseInt(document.getElementById("year").value);
            let utcOffset = parseInt(document.getElementById("utcOffset").value);
            let tbody = document.querySelector("#resultTable tbody");
            tbody.innerHTML = "";
            
            let phases = ["Nuova Luna", "Primo Quarto", "Luna Piena", "Ultimo Quarto"];
            let results = [];
            
            for (let month = 1; month <= 12; month++) {
                let lunarData = calcola_fasi_lunari(year, month);
                
                for (let i = 0; i < lunarData.length; i++) {
                    let date = new Date(lunarData[i].data);
                    date.setHours(date.getHours() + utcOffset); // Applica l'offset UTC
                    
                    let formattedDate = date.toISOString().split("T")[0];
                    let formattedTime = date.toTimeString().split(" ")[0].substring(0, 5);
                    
                    results.push({ date: formattedDate, time: formattedTime, phase: phases[i] });
                }
            }
            
            results.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            results.forEach(item => {
                let row = `<tr><td>${item.date}</td><td>${item.time}</td><td>${item.phase}</td></tr>`;
                tbody.innerHTML += row;
            });
        }
    </script>
</body>
</html>
